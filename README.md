# Kind Multi-Cluster Deployment Tool

è¿™æ˜¯ä¸€ä¸ªç”¨äºå¿«é€Ÿéƒ¨ç½²åŸºäº Kind çš„å¤šé›†ç¾¤ Kubernetes ç¯å¢ƒå¹¶è‡ªåŠ¨é…ç½® Prometheus ç›‘æ§å’Œ RBAC çš„è‡ªåŠ¨åŒ–å·¥å…·ã€‚

## ğŸš€ é¡¹ç›®åŠŸèƒ½

- **è‡ªåŠ¨åŒ–å¤šé›†ç¾¤åˆ›å»º**ï¼šä¸€é”®åˆ›å»º 3 ä¸ª Kind é›†ç¾¤ï¼ˆ1 ä¸ª Hub é›†ç¾¤ï¼Œ2 ä¸ª Worker é›†ç¾¤ï¼‰ã€‚
- **å†…ç½®äºŒè¿›åˆ¶å·¥å…·**ï¼šåœ¨ `1-bin/` ç›®å½•ä¸‹é¢„ç½®äº† `kubectl`, `helm`, `kind`ï¼Œæ— éœ€æ‰‹åŠ¨å®‰è£…ã€‚
- **è‡ªåŠ¨ç›‘æ§éƒ¨ç½²**ï¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªé›†ç¾¤å®‰è£… Prometheus ç›‘æ§ç³»ç»Ÿï¼Œå¹¶é€šè¿‡ NodePort (30001) æš´éœ²æœåŠ¡ã€‚
- **RBAC é…ç½®è‡ªåŠ¨åŒ–**ï¼šè‡ªåŠ¨é…ç½® ServiceAccount (`drl-scheduler-remote`) å¹¶æå– API Tokenã€‚
- **ç¯å¢ƒå…¼å®¹æ€§**ï¼šä½¿ç”¨äº† `kindest/node:v1.27.3` é•œåƒï¼Œå¯¹ cgroup v1 ç³»ç»Ÿæœ‰æ›´å¥½çš„æ”¯æŒã€‚

## ğŸ“‚ ç›®å½•ç»“æ„

```text
.
â”œâ”€â”€ 1-bin/            # é¢„ç½®äºŒè¿›åˆ¶å·¥å…· (kind, kubectl, helm)
â”œâ”€â”€ 2-configs/        # Kind é›†ç¾¤é…ç½®æ–‡ä»¶ (.yaml)
â”œâ”€â”€ 3-monitor/        # Prometheus ç›‘æ§é…ç½®
â”œâ”€â”€ 4-rbac/           # RBAC æƒé™é…ç½®
â”œâ”€â”€ 5-ops/            # è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬
â””â”€â”€ README.md         # é¡¹ç›®æ–‡æ¡£
```

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹

### 1. å‰ç½®è¦æ±‚
- å·²å®‰è£… Docker å¹¶ç¡®ä¿å½“å‰ç”¨æˆ·æœ‰æƒé™è¿è¡Œï¼ˆå¦‚å·²åŠ å…¥ `docker` ç»„ï¼‰ã€‚

### 2. æ‰§è¡Œéƒ¨ç½²
è¿è¡Œä¸»éƒ¨ç½²è„šæœ¬ï¼š
```bash
bash 5-ops/start_deploy.sh
```

è¯¥è„šæœ¬å°†æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
1. æ£€æŸ¥å¹¶åˆ é™¤æ—§çš„åŒåé›†ç¾¤ã€‚
2. åˆ›å»º `hub-cluster-a10`, `cluster-a10-01`, `cluster-a10-02`ã€‚
3. åœ¨æ¯ä¸ªé›†ç¾¤ä¸­éƒ¨ç½² Prometheusã€‚
4. åº”ç”¨ RBAC é…ç½®å¹¶è¾“å‡ºæ¯ä¸ªé›†ç¾¤çš„ API Server åœ°å€åŠ Tokenã€‚

### 3. è·å–é›†ç¾¤ä¿¡æ¯
å¦‚æœä½ åªéœ€è¦é‡æ–°è·å–ç°æœ‰é›†ç¾¤çš„ Token å’Œé…ç½®ä¿¡æ¯ï¼Œå¯ä»¥å•ç‹¬è¿è¡Œï¼š
```bash
cd 5-ops
./get-all-rbac-token.sh
```

## ğŸ“Š ç›‘æ§è®¿é—®
éƒ¨ç½²å®Œæˆåï¼ŒPrometheus å°†å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®ï¼š
- **NodePort**: `http://<Cluster_IP>:30001`
- å…·ä½“çš„è®¿é—® IP ä¼šåœ¨è„šæœ¬æ‰§è¡Œç»“æŸæ—¶çš„ JSON è¾“å‡ºä¸­æ˜¾ç¤ºã€‚

## âš™ï¸ å¸¸è§é—®é¢˜ (FAQ)

**Q: æ‰§è¡Œè„šæœ¬æç¤º Docker æƒé™é—®é¢˜ï¼Ÿ**
A: è¯·å‚è€ƒè„šæœ¬æç¤ºè¿è¡Œï¼š
   `sudo rm /etc/systemd/system/docker.service.d/override.conf && sudo systemctl restart docker`
   æˆ–ç¡®ä¿ç”¨æˆ·å·²åŠ å…¥ `docker` ç»„ã€‚

**Q: å¦‚ä½•æ‰‹åŠ¨æ¸…ç†ç¯å¢ƒï¼Ÿ**
A: è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ é™¤æ‰€æœ‰é›†ç¾¤ï¼š
   ```bash
   kind delete clusters hub-cluster-a10 cluster-a10-01 cluster-a10-02
   ```

## ğŸ“„ æˆæƒ
MIT License
